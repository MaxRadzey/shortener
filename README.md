# Shortener

## Описание проекта

Shortener — это веб-сервис для сокращения длинных URL-адресов. Сервис позволяет создавать короткие ссылки из длинных URL и перенаправлять пользователей на оригинальные адреса.

### Основные возможности:

- **Создание коротких URL** через POST-запросы (поддержка текстового и JSON форматов)
- **Редирект на оригинальный URL** по короткой ссылке
- **Хранение данных** в PostgreSQL или файловой системе
- **Проверка соединения с базой данных** через эндпоинт `/ping`
- **Сжатие ответов** с помощью Gzip
- **Логирование запросов и ответов**

### Технологический стек:

- **Go 1.24** — язык программирования
- **Gin** — веб-фреймворк
- **PostgreSQL** — база данных
- **Zap** — структурированное логирование
- **Docker & Docker Compose** — контейнеризация

## Локальный запуск

### Предварительные требования

- [Docker](https://www.docker.com/get-started) и [Docker Compose](https://docs.docker.com/compose/install/)
- [Go](https://go.dev/dl/) версии 1.24 или выше (для локальной разработки)

### Запуск через Docker Compose

1. **Клонируйте репозиторий:**
   ```bash
   git clone <repository-url>
   cd shortener
   ```

2. **Запустите сервисы:**
   ```bash
   docker-compose up -d
   ```

   Эта команда запустит:
   - PostgreSQL базу данных на порту `5432`
   - API сервер на порту `8080`

3. **Проверьте работу сервиса:**
   ```bash
   curl http://localhost:8080/ping
   ```

4. **Остановка сервисов:**
   ```bash
   docker-compose down
   ```

### Установка зависимостей для локальной разработки

Если вы хотите запускать проект локально без Docker:

1. **Установите зависимости Go:**
   ```bash
   go mod download
   ```

2. **Убедитесь, что PostgreSQL запущен и доступен**, или настройте переменные окружения для использования файлового хранилища.

3. **Запустите приложение:**
   ```bash
   go run cmd/shortener/main.go
   ```

### Переменные окружения

При необходимости вы можете настроить следующие переменные окружения:

- `SERVER_ADDRESS` — адрес и порт сервера (по умолчанию: `:8080`)
- `BASE_URL` — базовый URL для генерации коротких ссылок (по умолчанию: `http://localhost:8080`)
- `DATABASE_DSN` — строка подключения к PostgreSQL (например: `postgres://user:password@localhost:5432/shortener`)
- `LOG_LEVEL` — уровень логирования (по умолчанию: `info`)
- `FILE_PATH` — путь к файлу для хранения данных, если не используется БД (по умолчанию: `/tmp/data.json`)

### Примеры использования API

**Создание короткой ссылки (текстовый формат):**
```bash
curl -X POST http://localhost:8080/ \
  -H "Content-Type: text/plain" \
  -d "https://example.com/very/long/url"
```

**Создание короткой ссылки (JSON формат):**
```bash
curl -X POST http://localhost:8080/api/shorten \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com/very/long/url"}'
```

**Получение оригинального URL (редирект):**
```bash
curl -L http://localhost:8080/<short_path>
```

**Проверка соединения с БД:**
```bash
curl http://localhost:8080/ping
```

## Обновление шаблона

Чтобы иметь возможность получать обновления автотестов и других частей шаблона, выполните команду:

```bash
git remote add -m main template https://github.com/Yandex-Practicum/go-musthave-shortener-tpl.git
```

Для обновления кода автотестов выполните команду:

```bash
git fetch template && git checkout template/main .github
```

Затем добавьте полученные изменения в свой репозиторий.

## Запуск автотестов

Для успешного запуска автотестов называйте ветки `iter<number>`, где `<number>` — порядковый номер инкремента. Например, в ветке с названием `iter4` запустятся автотесты для инкрементов с первого по четвёртый.

При мёрже ветки с инкрементом в основную ветку `main` будут запускаться все автотесты.

Подробнее про локальный и автоматический запуск читайте в [README автотестов](https://github.com/Yandex-Practicum/go-autotests).
